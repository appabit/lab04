<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Interactive Web Mapping â€“ US Population Density</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />

  <!-- Mapbox GL JS -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>

  <style>
    h2, h3 { margin: 10px; font-size: 18px; }
    h3 { font-size: 16px; }
    p { margin: 10px; }

    #map {
      position: absolute;
      top: 0; bottom: 0; left: 0; right: 0;
    }

    .map-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      background: rgba(255,255,255,0.8);
      border: 1px solid rgba(0,0,0,0.2);
      margin-left: 20px;
      font-family: Arial, sans-serif;
      overflow: auto;
      border-radius: 3px;
    }

    #features {
      top: 0;
      height: 100px;
      margin-top: 20px;
      width: 250px;
    }

    #legend {
      padding: 10px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
      line-height: 18px;
      height: 210px;
      margin-bottom: 40px;
      width: 150px;
    }

    .legend-key {
      display: inline-block;
      border-radius: 20%;
      width: 10px;
      height: 10px;
      margin-right: 5px;
    }
  </style>
</head>

<body>

<div id="map"></div>

<div class="map-overlay" id="features">
  <h2>US population density</h2>
  <div id="text-description">
    <p>Hover over a state!</p>
  </div>
</div>

<div class="map-overlay" id="legend"></div>

<script>
  mapboxgl.accessToken = 'pk.eyJ1IjoiamRjYXNoOCIsImEiOiJjbWh5OWxucXgwYWh3MmtxMGtobzBteGhlIn0.3D-fasXUhyLzanGarMk-yA';

  const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/light-v10',
    zoom: 3,
    center: [-100, 40]
  });

  async function geojsonFetch() {
    const response = await fetch("assets/state_data.geojson");  
    const stateData = await response.json();

    map.on("load", () => {

      map.addSource("state_data", {
        type: "geojson",
        data: stateData
      });

      map.addLayer({
        id: "state_data-layer",
        type: "fill",
        source: "state_data",
        paint: {
          "fill-color": [
            "step",
            ["get", "density"],
            "#FFEDA0", 10,
            "#FED976", 20,
            "#FEB24C", 50,
            "#FD8D3C", 100,
            "#FC4E2A", 200,
            "#E31A1C", 500,
            "#BD0026", 1000,
            "#800026"
          ],
          "fill-outline-color": "#BBBBBB",
          "fill-opacity": 0.7
        }
      });

      // Legend
      const layers = ["0-9","10-19","20-49","50-99","100-199","200-499","500-999","1000+"];
      const colors = ["#FFEDA070","#FED97670","#FEB24C70","#FD8D3C70","#FC4E2A70","#E31A1C70","#BD002670","#80002670"];

      const legend = document.getElementById("legend");
      legend.innerHTML = "<b>Population Density<br>(people/sq.mi.)</b><br><br>";

      layers.forEach((layer, i) => {
        const item = document.createElement("div");
        const key = document.createElement("span");
        key.className = "legend-key";
        key.style.backgroundColor = colors[i];

        const value = document.createElement("span");
        value.innerHTML = layer;

        item.appendChild(key);
        item.appendChild(value);
        legend.appendChild(item);
      });

      // Hover
      map.on("mousemove", (ev) => {
        const state = map.queryRenderedFeatures(ev.point, { layers: ["state_data-layer"] });
        const info = document.getElementById("text-description");

        if (state.length > 0) {
          const p = state[0].properties;
          info.innerHTML = `<h3>${p.name}</h3>
            <p><strong>${p.density}</strong> people per square mile</p>`;
        } else {
          info.innerHTML = "<p>Hover over a state!</p>";
        }
      });
    });
  }

  geojsonFetch();
</script>

</body>
</html>